<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>xyslion的笔记屋  | Spring中的SmartLifecycle作用</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.56.0-DEV" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/blog/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Spring中的SmartLifecycle作用" />
<meta property="og:description" content="Spring中的SmartLifecycle作用 Spring SmartLifecycle在spring容器所有bean加载和初始化完毕后执行 SmartLifecycle 是一个接" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xyslion.github.io/blog/post/spring_smart_life_cycle/" />
<meta property="article:published_time" content="2019-08-02T10:44:46+08:00" />
<meta property="article:modified_time" content="2019-08-02T10:44:46+08:00" />
<meta itemprop="name" content="Spring中的SmartLifecycle作用">
<meta itemprop="description" content="Spring中的SmartLifecycle作用 Spring SmartLifecycle在spring容器所有bean加载和初始化完毕后执行 SmartLifecycle 是一个接">


<meta itemprop="datePublished" content="2019-08-02T10:44:46&#43;08:00" />
<meta itemprop="dateModified" content="2019-08-02T10:44:46&#43;08:00" />
<meta itemprop="wordCount" content="1276">



<meta itemprop="keywords" content="java,spring," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring中的SmartLifecycle作用"/>
<meta name="twitter:description" content="Spring中的SmartLifecycle作用 Spring SmartLifecycle在spring容器所有bean加载和初始化完毕后执行 SmartLifecycle 是一个接"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://xyslion.github.io/blog/" class="f3 fw2 hover-white no-underline white-90 dib">
      xyslion的笔记屋
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/blog/post/" title="Posts page">
              Posts
            </a>
          </li>
          
        </ul>
      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Spring中的SmartLifecycle作用</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2019-08-02T10:44:46&#43;08:00">August 2, 2019</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<h1 id="spring中的smartlifecycle作用">Spring中的SmartLifecycle作用</h1>

<p><code>Spring SmartLifecycle在spring容器所有bean加载和初始化完毕后执行</code></p>

<p>SmartLifecycle 是一个接口. 当Spring容器加载所有bean并执行完初始化之后,会接着回调实现该接口的类中对应的方法(<code>start()方法</code>).</p>

<pre><code class="language-java">import org.springframework.context.SmartLifecycle;
import org.springframework.stereotype.Component;

/**
 * SmartLifecycle测试
 *
 *
 *
 */
@Component
public class TestSmartLifecycle implements SmartLifecycle {

    private boolean isRunning = false;

    /**
     * 1. 我们主要在该方法中启动任务或者其他异步服务，比如开启MQ接收消息&lt;br/&gt;
     * 2. 当上下文被刷新（所有对象已被实例化和初始化之后）时，将调用该方法，默认生命周期处理器将检查每个SmartLifecycle对象的isAutoStartup()方法返回的布尔值。
     * 如果为“true”，则该方法会被调用，而不是等待显式调用自己的start()方法。
     */
    @Override
    public void start() {
        System.out.println(&quot;start&quot;);

        // 执行完其他业务后，可以修改 isRunning = true
        isRunning = true;
    }

    /**
     * 如果工程中有多个实现接口SmartLifecycle的类，则这些类的start的执行顺序按getPhase方法返回值从小到大执行。&lt;br/&gt;
     * 例如：1比2先执行，-1比0先执行。 stop方法的执行顺序则相反，getPhase返回值较大类的stop方法先被调用，小的后被调用。
     */
    @Override
    public int getPhase() {
        // 默认为0
        return 0;
    }

    /**
     * 根据该方法的返回值决定是否执行start方法。&lt;br/&gt;
     * 返回true时start方法会被自动执行，返回false则不会。
     */
    @Override
    public boolean isAutoStartup() {
        // 默认为false
        return true;
    }

    /**
     * 1. 只有该方法返回false时，start方法才会被执行。&lt;br/&gt;
     * 2. 只有该方法返回true时，stop(Runnable callback)或stop()方法才会被执行。
     */
    @Override
    public boolean isRunning() {
        // 默认返回false
        return isRunning;
    }

    /**
     * SmartLifecycle子类的才有的方法，当isRunning方法返回true时，该方法才会被调用。
     */
    @Override
    public void stop(Runnable callback) {
        System.out.println(&quot;stop(Runnable)&quot;);

        // 如果你让isRunning返回true，需要执行stop这个方法，那么就不要忘记调用callback.run()。
        // 否则在你程序退出时，Spring的DefaultLifecycleProcessor会认为你这个TestSmartLifecycle没有stop完成，程序会一直卡着结束不了，等待一定时间（默认超时时间30秒）后才会自动结束。
        // PS：如果你想修改这个默认超时时间，可以按下面思路做，当然下面代码是springmvc配置文件形式的参考，在SpringBoot中自然不是配置xml来完成，这里只是提供一种思路。
        // &lt;bean id=&quot;lifecycleProcessor&quot; class=&quot;org.springframework.context.support.DefaultLifecycleProcessor&quot;&gt;
        //      &lt;!-- timeout value in milliseconds --&gt;
        //      &lt;property name=&quot;timeoutPerShutdownPhase&quot; value=&quot;10000&quot;/&gt;
        // &lt;/bean&gt;
        callback.run();

        isRunning = false;
    }

    /**
     * 接口Lifecycle的子类的方法，只有非SmartLifecycle的子类才会执行该方法。&lt;br/&gt;
     * 1. 该方法只对直接实现接口Lifecycle的类才起作用，对实现SmartLifecycle接口的类无效。&lt;br/&gt;
     * 2. 方法stop()和方法stop(Runnable callback)的区别只在于，后者是SmartLifecycle子类的专属。
     */
    @Override
    public void stop() {
        System.out.println(&quot;stop&quot;);

        isRunning = false;
    }

}
</code></pre>
<ul class="pa0">
  
   <li class="list">
     <a href="/blog/tags/java" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">java</a>
   </li>
  
   <li class="list">
     <a href="/blog/tags/spring" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">spring</a>
   </li>
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://xyslion.github.io/blog/" >
    &copy; 2019 xyslion的笔记屋
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/blog/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
